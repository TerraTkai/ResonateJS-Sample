resonate.inModule("Tasks").setLocalization().forLocales("en-gb","fr-fr").withDefault("en-gb").from("/localization/tasks.localization.{locale}.json"),resonate.inModule("Tasks").createAttribute("localize-help").with("Content").as(function(e,t){var a=e.element;e.on("render",function(){a.style.position="relative",t.insert(a,'<div class="help"><div localize="{localizeHelp}"></div></div>',a.childNodes.length)})}),resonate.inModule("Tasks").createExpression("formatDateTime").with("Localization").as(function(a){return function(e){e=e||new Date;var t=a.getLocale();return e.toLocaleDateString(t)+" "+e.toLocaleTimeString([t],{hour12:!1,hour:"2-digit",minute:"2-digit"})}}),resonate.inModule("Tasks").createExpression("getStatus").with("Localization").as(function(t){function a(){s.forEach(function(e){e.name=t.localize(e.key)})}var s=null;return function(e){return s||(s=[{key:"status-pending"},{key:"status-overdue"},{key:"status-complete"}],a(),t.onLocaleChange(a)),s[e-1].name}}),resonate.inModule("Tasks").createService("TasksRepository").asSingleton(function(e){function s(e){var t=!1;if(3!==e.statusId){var a=e.due<new Date;(a&&1===e.statusId||!a&&2===e.statusId)&&(e.statusId=a?2:1,t=!0)}return t}function t(){n.sort(function(e,t){return e.due<t.due?-1:e.due>t.due?1:0}),localStorage.setItem("tasks",JSON.stringify(n))}var n=[],i=function(){clearTimeout(0);var e=new Date,t=6e4-(1e3*e.getSeconds()+e.getMilliseconds()),a=!1;n.forEach(function(e){s(e)&&(a=!0)}),a&&resonate.refresh(),setTimeout(i,t,!0)};e.getTasks=function(){return n},e.deleteTask=function(e){n.remove(e),t()},e.addTask=function(e){n.push(e),s(e),t()},e.updateTask=function(e){s(e),t()},e.getTask=function(e){for(var t=0,a=0;a<n.length;a++){if(n[a].id===parseInt(e))return n[a];n[a].id>t&&(t=n[a].id)}return{id:t+1,description:"",due:null,statusId:1,created:new Date,updated:new Date}};var a=localStorage.getItem("tasks");a&&(n=JSON.parse(a)).forEach(function(e){e.due=new Date(Date.parse(e.due)),e.created=new Date(Date.parse(e.created)),e.updated=new Date(Date.parse(e.updated))}),i()}),resonate.inModule("Tasks").createComponent("tasks-header").as(function(e){}),resonate.inModule("Tasks").createComponent("tasks-section").as(function(e){}),resonate.inModule("Tasks").createView("tasks-dashboard").at("/demo/tasks").with("TasksRepository").as(function(t,a){t.statistics={complete:0,overdue:0,pending:0},t.nextTask=null,t.tasks=a.getTasks(),t.deleteTask=function(e,t){t.preventDefault(),t.stopPropagation(),a.deleteTask(e)},t.on("evaluate",function(){t.statistics.complete=0,t.statistics.overdue=0,t.statistics.pending=0,t.nextTask=null,t.tasks.forEach(function(e){switch(t.nextTask||3===e.statusId||(t.nextTask=e),e.statusId){case 1:t.statistics.pending++;break;case 2:t.statistics.overdue++;break;case 3:t.statistics.complete++}})})}),resonate.inModule("Tasks").createView("task-details").with("TasksRepository","Routing").at("/demo/tasks/details","/demo/tasks/details/{task-id}").as(function(e,t,a){var s=t.getTask(e.routeData.taskId);e.task={id:s.id,statusId:s.statusId,description:s.description,created:s.created,updated:s.updated,dueDate:"",dueTime:"",isNewTask:!s.due},s.due&&(e.task.dueDate=s.due.toLocaleDateString("en-GB").split("/").reverse().join("-"),e.task.dueTime=s.due.toLocaleTimeString("en-GB",{hour12:!1,hour:"2-digit",minute:"2-digit"})),e.dueChanged=!1,e.descriptionChanged=!1,e.save=function(){s.description=e.task.description,s.due=new Date(Date.parse(e.task.dueDate+" "+e.task.dueTime)),s.statusId=e.task.statusId,e.task.isNewTask?t.addTask(s):(s.updated=new Date,t.updateTask(s)),a.changeRoute("/demo/tasks")},e.complete=function(){e.task.statusId=3,e.save()},e.cancel=function(){a.changeRoute("/demo/tasks")},e.isValid=function(){return""!==e.task.description&&""!==e.task.dueDate&&""!==e.task.dueTime}});